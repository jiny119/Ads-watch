<!-- ... HEAD part same as before ... -->

<script>
  function logActivity(text) {
    let logs = JSON.parse(localStorage.getItem("activityLogs")) || [];
    const now = new Date().toLocaleString();
    logs.push(`${text} at ${now}`);
    localStorage.setItem("activityLogs", JSON.stringify(logs));
  }

  function openSurvey() {
    window.open("https://www.youtube.com/@ToonCraftStudio-f7o", "_blank");
    setTimeout(() => {
      let earnings = parseFloat(localStorage.getItem("goldEarnings") || "0");
      earnings += 0.15;
      localStorage.setItem("goldEarnings", earnings.toFixed(2));
      updateEarningsDisplay();
      alert("Survey complete! You earned $0.15");
    }, 10000);
  }

  function updateEarningsDisplay() {
    let earnings = parseFloat(localStorage.getItem("goldEarnings") || "0");
    document.getElementById("totalEarnings").innerText = `Total Earnings: $${earnings.toFixed(2)}`;
  }

  if (localStorage.getItem("goldLoggedIn") === "true") {
    updateEarningsDisplay();
  }

  function copyReferralLink() {
    const text = document.getElementById("referralText").innerText;
    navigator.clipboard.writeText(text).then(() => {
      alert("Referral link copied!");
    });
  }

  function fakeWithdrawal() {
    document.querySelector("button").style.display = "none"; 
    document.getElementById("fakeWithdrawalMsg").style.display = "block";
    setTimeout(() => {
      document.getElementById("fakeWithdrawalMsg").innerText = "Your withdrawal request has been processed successfully!";
      setTimeout(() => {
        document.getElementById("fakeWithdrawalMsg").style.display = "none";
        document.querySelector("button").style.display = "block";
      }, 3000);
    }, 3000);
  }

  function signup() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    if (user && pass) {
      localStorage.setItem("goldUser", JSON.stringify({ user, pass }));
      alert("Signup successful! Now login.");

      // === Referral Coin Add on Signup ===
      let savedReferrer = localStorage.getItem("pending_referral");
      if (savedReferrer && !localStorage.getItem("referral_given")) {
        let refKey = `coins_${savedReferrer}`;
        let current = parseInt(localStorage.getItem(refKey) || "0");
        localStorage.setItem(refKey, current + 100); // 100 coins
        localStorage.setItem("referral_given", "true");
      }

    } else {
      alert("Please enter both username and password.");
    }
  }

  function login() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    const saved = JSON.parse(localStorage.getItem("goldUser"));

    if (saved && user === saved.user && pass === saved.pass) {
      localStorage.setItem("goldLoggedIn", "true");
      localStorage.setItem("loggedInUser", user); // Save current username
      showDashboard();
    } else {
      alert("Invalid credentials.");
    }
  }

  function logout() {
    localStorage.removeItem("goldLoggedIn");
    localStorage.removeItem("loggedInUser");
    location.reload();
  }

  function showDashboard() {
    document.getElementById("authContainer").style.display = "none";
    document.getElementById("welcomeMessage").style.display = "block";
    setTimeout(() => {
      document.getElementById("welcomeMessage").style.display = "none";
      document.getElementById("mainContainer").style.display = "block";
      let coins = parseInt(localStorage.getItem("coins") || "0");
      updateCoinsDisplay(coins);

      // Update referral text with username
      const currentUser = localStorage.getItem("loggedInUser") || "MyUsername";
      document.getElementById("referralText").innerText = `https://ads-watch-anj9.vercel.app/#ref=${currentUser}`;
    }, 2000);
  }

  if (localStorage.getItem("goldLoggedIn") === "true") {
    showDashboard();
  }

  // === Referral URL Capture and Save in LocalStorage ===
  const urlParams = new URLSearchParams(window.location.hash.slice(1));
  const referrer = urlParams.get("ref");
  if (referrer) {
    localStorage.setItem("pending_referral", referrer);
  }

  // ===== Daily Check-In Reward Functionality =====
  function dailyCheckInReward() {
    let lastLogin = localStorage.getItem("lastLoginDate");
    let currentDate = new Date().toLocaleDateString();
    if (lastLogin !== currentDate) {
      localStorage.setItem("lastLoginDate", currentDate);
      let streak = parseInt(localStorage.getItem("streak") || "0");
      let reward = getDailyReward(streak);
      let currentCoins = parseInt(localStorage.getItem("coins") || "0");
      currentCoins += reward;
      localStorage.setItem("coins", currentCoins);
      localStorage.setItem("streak", streak + 1);
      alert(`You earned ${reward} coins for today's check-in!`);
      updateCoinsDisplay(currentCoins);
    } else {
      alert("You already checked in today. Come back tomorrow!");
    }
  }

  function getDailyReward(streak) {
    if (streak >= 6) {
      return 50;
    }
    return (streak + 1) * 5;
  }

  function updateCoinsDisplay(coins) {
    document.getElementById("coinsDisplay").innerText = `Total Coins: ${coins}`;
  }

  document.addEventListener("DOMContentLoaded", function() {
    let savedCoins = parseInt(localStorage.getItem("coins") || "0");
    updateCoinsDisplay(savedCoins);
  });
</script>
